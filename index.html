<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <title>整理券配布ページ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f0f4f8;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 30px;
        }

        #buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }

        .game-block {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 220px;
            text-align: center;
            transition: transform 0.2s;
        }

        .game-block:hover {
            transform: translateY(-4px);
        }

        .game-block button {
            background: #00796b;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .game-block button:hover {
            background: #00695c;
        }

        .description,
        .waiting-count {
            font-size: 0.95rem;
            color: #555;
            margin-top: 5px;
        }

        .admin-login,
        #adminPanel {
            margin-top: 40px;
            padding: 20px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
        }

        .admin-login input {
            padding: 10px;
            font-size: 1rem;
            margin-right: 10px;
        }

        .admin-login button {
            padding: 10px 20px;
            font-size: 1rem;
            background: #0288d1;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        #adminPanel button {
            margin-top: 20px;
        }

        .ticket-list {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        .ticket-list label {
            display: block;
            font-size: 16px;
            margin-bottom: 4px;
        }
    </style>
</head>

<body>
    <h1>ゲームセンター<br />整理券配布</h1>
    <div id="buttons"></div>

    <div class="admin-login">
        <h3>管理者ログイン</h3>
        <input type="password" id="passwordInput" placeholder="パスワードを入力" />
        <button onclick="loginAdmin()">ログイン</button>
    </div>

    <div id="adminPanel" style="display:none;">
        <h2>管理者ビュー</h2>
        <div id="adminView"></div>
        <button style="background-color: #e53935; color: white;" onclick="resetTickets()">全整理券をリセット</button>
    </div>

    <script>
        const gameTitles = {
            game1: "ガールズXFIRE",
            game2: "燃えよPizzas",
            game3: "fallingslime",
            game4: "PanicStation",
            game5: "へんけいマシンひとりたび",
        };

        let ticketData = {
            game1: [],
            game2: [],
            game3: [],
            game4: [],
            game5: [],
        };

        let usedTickets = {
            game1: new Set(),
            game2: new Set(),
            game3: new Set(),
            game4: new Set(),
            game5: new Set(),
        };

        function getTicket(gameId) {
            const ticketNumber = ticketData[gameId].length + 1;
            ticketData[gameId].push(ticketNumber);

            const newWindow = window.open("", "_blank");
            newWindow.document.write(`
        <html lang="ja">
        <head><meta charset="UTF-8" /><title>整理券番号</title>
          <style>
            body {
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              height: 100vh;
              margin: 0;
              font-family: 'Segoe UI', sans-serif;
              background: #e0f7fa;
              color: #00796b;
              text-align: center;
              padding: 20px;
            }
            h1 {
              font-size: 6rem;
              margin-bottom: 20px;
            }
            p {
              font-size: 2rem;
              margin-top: 0;
            }
          </style>
        </head>
        <body>
          <h1>整理券番号<br /><strong>${ticketNumber}</strong></h1>
          <p>スクリーンショットをして遊ぶ際に<br />近くのスタッフに見せてください</p>
        </body>
        </html>
      `);
            newWindow.document.close();

            updateUserView();
            updateAdminView();
        }

        function updateAdminView() {
            const adminDiv = document.getElementById("adminView");
            adminDiv.innerHTML = "";

            let totalWaiting = 0;

            for (const game in ticketData) {
                const waitingCount = ticketData[game].filter(num => !usedTickets[game].has(num)).length;
                totalWaiting += waitingCount;

                adminDiv.innerHTML += `<p><strong>${gameTitles[game]}</strong> - 待ち人数: ${waitingCount}人</p>`;

                if (ticketData[game].length > 0) {
                    const ticketListHTML = ticketData[game]
                        .map((num) => {
                            const checked = usedTickets[game].has(num) ? "checked" : "";
                            return `
                <label>
                  <input type="checkbox" onchange="toggleUsedTicket('${game}', ${num}, this.checked)" ${checked}>
                  整理券番号 ${num} ${checked ? '(処理済み)' : ''}
                </label>
              `;
                        })
                        .join("");
                    adminDiv.innerHTML += `<div class="ticket-list">${ticketListHTML}</div>`;
                } else {
                    adminDiv.innerHTML += `<p>発行された整理券はありません。</p>`;
                }
            }

            adminDiv.innerHTML += `<p><strong>合計 待ち人数:</strong> ${totalWaiting}人</p>`;
        }

        function toggleUsedTicket(gameId, ticketNum, isChecked) {
            if (isChecked) {
                usedTickets[gameId].add(ticketNum);
            } else {
                usedTickets[gameId].delete(ticketNum);
            }
            updateAdminView();
            updateUserView();
        }

        function updateUserView() {
            for (let i = 1; i <= 5; i++) {
                const gameId = `game${i}`;
                const block = document.getElementById(`block-${gameId}`);
                const waitingDiv = block.querySelector(".waiting-count");
                const waiting = ticketData[gameId].filter(num => !usedTickets[gameId].has(num)).length;
                waitingDiv.textContent = `現在の待ち人数: ${waiting}人`;
            }
        }

        function setupButtons() {
            const buttonsDiv = document.getElementById("buttons");
            buttonsDiv.innerHTML = "";
            for (let i = 1; i <= 5; i++) {
                const gameId = `game${i}`;
                const block = document.createElement("div");
                block.className = "game-block";
                block.id = `block-${gameId}`;

                const btn = document.createElement("button");
                btn.textContent = `${gameTitles[gameId]}`;
                btn.onclick = () => getTicket(gameId);

                const desc = document.createElement("div");
                desc.className = "description";
                desc.textContent = "説明文";

                const waiting = document.createElement("div");
                waiting.className = "waiting-count";
                waiting.textContent = "現在の待ち人数: 0人";

                block.appendChild(btn);
                block.appendChild(desc);
                block.appendChild(waiting);
                buttonsDiv.appendChild(block);
            }
        }

        function resetTickets() {
            if (confirm("本当にすべての整理券をリセットしますか？")) {
                for (const game in ticketData) {
                    ticketData[game] = [];
                    usedTickets[game].clear();
                }
                updateAdminView();
                updateUserView();
            }
        }

        function loginAdmin() {
            const password = document.getElementById("passwordInput").value;
            if (password === "oecugame") {
                document.getElementById("adminPanel").style.display = "block";
                updateAdminView();
            } else {
                alert("パスワードが間違っています。");
            }
        }

        setupButtons();
    </script>
</body>

</html>